<!DOCTYPE html>
  <html lang="ja-jp">
    <head>
      <title>いいやつの作りかた</title>
      <meta charset="UTF-8">
      <meta name="author" content="hrfmmymt">
      <meta name="copyright" content="Copyright(c)hrfmmymt. 2022 All Rights Reserved.">
      <meta name="description" content="これのやつ">
      <meta name="format-detection" content="telephone=no,address=no,email=no">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="theme-color" content="#fff" media="(prefers-color-scheme: light)">
      <meta name="theme-color" content="#332f21" media="(prefers-color-scheme: dark)">
      <meta property="og:description" content="これのやつ">
      <meta property="og:title" content="いいやつの作りかた">
      <meta property="og:url" content="20180730">
      <meta property="og:image" content="public/img/icon/icon.png">
      <meta property="og:type" content="website">
      <meta property="og:locale" content="ja_JP">

      <link rel="canonical" href="20180730">
      <link rel="shortcut icon" type="image/x-icon" href="public/img/icon/favicon.ico">
      <link rel="manifest" href="public/manifest.json">
      <link rel="image_src" href="public/img/icon/icon.png">
      <link rel="icon" type="image/png" href="public/img/icon/icon.png">
      <link rel="apple-touch-icon" href="public/img/icon/icon.png">
      <link rel="preconnect" href="https://fonts.googleapis.com/" crossorigin>
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans">
      <style>a,article,blockquote,body,div,footer,h1,h2,h3,header,html,li,nav,p,time,ul{margin:0;padding:0}:root{--text-color:#000;--text-color-sub:#555;--text-color-anchor:#db2c17;--page-background-color:#fff;--code-background-color:#f4f4f4;--code-border-color:#ddd;--skeleton-color:#f4f4f4}@media (prefers-color-scheme:dark){:root{--text-color:#fff;--text-color-sub:#f2f1ef;--text-color-anchor:#00b5b5;--page-background-color:#332f21;--code-background-color:#1e1d16;--code-border-color:#424137;--skeleton-color:#272419}}html{font-size:calc(1em + .5vw)}body{font-feature-settings:"palt";-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;background-color:var(--page-background-color);color:var(--text-color);font-family:Open Sans,Helvetica Neue,sans-serif;font-kerning:normal;letter-spacing:.1em}a{color:var(--text-color-anchor)}a:visited{color:inherit}ul{list-style-type:none}.header{margin:1.5rem 0 1.2rem;text-align:center}.header-title{font-size:1rem;letter-spacing:.05rem}.header-title .header-title-link{display:block;margin:0 auto;width:6rem}.header-title .header-title-link,.header-title .header-title-link:visited{color:inherit}.logo{fill:var(--text-color)}.footer{font-size:.8rem;margin:0 auto 1.5rem;max-width:32rem;padding:0 1rem}@media screen{.hljs-comment,.hljs-quote{color:var(--gray-60-alpha)}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:var(--caution-red-100)}.hljs-attr,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#831443}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:var(--primary-green-80)}.hljs-section,.hljs-title{color:#3a71a0}.hljs-keyword,.hljs-selector-tag{color:#9d00cf}.hljs{background:#f6f6f6;color:var(--gray-70-alpha);display:block;overflow-x:auto;padding:.5em}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}}@media screen and screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}@media screen and (prefers-color-scheme:dark){.hljs-comment,.hljs-quote{color:var(--white-60-alpha)}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:var(--caution-red-vivid-100)}.hljs-attr,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#e19c40}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:var(--secondary-green-50)}.hljs-section,.hljs-title{color:#8dcfec}.hljs-keyword,.hljs-selector-tag{color:#da8eed}.hljs{background:#1e2930;color:var(--white-80-alpha);display:block;overflow-x:auto;padding:.5em}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}}@media screen and (prefers-color-scheme:dark) and screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}.post-article,.post-recent{max-width:32rem}.post-article{line-height:2;margin:0 auto}.post-article h1{font-size:2rem}.post-article h2{border-bottom:1px solid;margin-bottom:1rem}.post-article h3{margin-bottom:-1rem;margin-top:.5rem}.post-article h4{margin:0 0 -1rem}.post-article p{word-wrap:break-word;margin:1rem 0}.post-article a{text-decoration:underline}.post-article li a{word-break:break-all}.post-article img,.post-article video{background-color:var(--skeleton-color);height:auto;width:100%}.post-article code{border:1px solid var(--code-border-color);border-radius:2px;margin:1.4em 0;overflow-wrap:break-word;padding:.1em}.post-article code,.post-article pre>code{background-color:var(--code-background-color)}.post-article pre>code{border:none;display:block;margin:0;overflow:auto;padding:.6em}.post-article blockquote{word-wrap:break-word;border-left:.25em solid #dfe2e5;color:var(--text-color-sub);margin:1em 0;padding:0 1em}.post-article ul{list-style-type:disc;margin:1rem 0;padding-left:2rem}.post-article ul li ul{list-style-type:circle;margin:0}.post-article ol{padding-left:2rem}.post-article .description,.post-article time{word-wrap:break-word;color:var(--text-color-sub);font-weight:400}.post-article time{font-size:.8rem}.post-article .description{font-size:.9rem}.post-recent{margin:3rem auto}@media (max-width:414px){.post-article{padding:0 1rem}}</style>
    </head>
    <body>
      <h1 id="いいやつの作りかた">いいやつの作りかた</h1>
<p><time datetime="2018-07-30">2018-07-30</time></p>
<p><em class="description">これのやつ</em></p>
<h2 id="はじめに">はじめに</h2>
<p>こんにちは、おうちフジロッカーです。YouTube のフジロックの配信で巻き戻し再放送見てたところ、誤操作でリロードして即配信終了となりました。ダーティー・プロジェクターズ途中だったのに。はい。</p>
<p>さて巷には、不定期的にブログを作る習性を持つ者が一定数おられるかと思いますが、私もその一人です。<br>今までにも WordPress、tumblr のカスタム、Jekyll、Gatsby など、お試しレベルから実運用に至るまで、様々なテンションでブログを扱ってまいりました。プログラミングを介さないものも含むともっとあると思います。なぜだかはわかりません。<br>皆様がご覧になられているこれもその一つである、理由もなくただ産み落とされた新しいブログです。今回はその作りかたを記事にします。</p>
<h2 id="構成">構成</h2>
<p>このブログは静的サイトジェネレーターで、markdown ファイルを Web サーバーでパースして HTML ファイルをホスティングするという仕組みが基礎となって出来ています。前述した Jekyll もそのうちの一つで、様々な人による様々な使われ方が想定してある優れたツールです。他の類似品として Hugo や Hexo などが挙げられます。ただ、今回は自分のブログが作りたかっただけなので、自分だけが良ければそれで良いというつもりでイチから手書きすることにしました。</p>
<h3 id="バックエンド">バックエンド</h3>
<p>Cloud Functions for Firebase + Firebase Hosting を使っています。<br>ホスティングをどうするか考えた際に、もともと Node.js + Express で書き始めていたのもあり、ホスティング・サービスも一元で扱える Firebase を選びました。<br>そうそう、Cloud Functions for Firebase はもともと Node.js を扱ってはいたのですが対応バージョンが古く、現行の新しいバージョンに対応している新しい処理記法が使えませんでした。それが以前の記事でも書きましたが、数日前に新バージョンに対応したというのも後押しになりました。最新というわけではないのですけれどね。</p>
<p>Firebase Hosting は CircleCI と連携し、ビルド後に自動でデプロイされるようにしています。  </p>
<p>テンプレートエンジンは mustache を使っています。一時期 EJS だったり、Nunjucks 見たり（結局 <a href="https://github.com/hrfmmymt/webper">webper</a> という webp の画像コンバーターで使いました）、あんまりこだわりはない部分ですね。</p>
<h3 id="フロントエンド">フロントエンド</h3>
<p>フロントエンドはスタイルシートで意匠を作る以外ほぼ何もすることがなさそうな気がしてたので <a href="https://www.ampproject.org/ja/">AMP</a> にしました。インデックスページと記事ページの行き来の想定しかない Web サイトにおいて、発生する UX の懸念というのは「表示が速いか遅いか」だけであろうという雑なデザイン思考です。<br>画像を amp-img というコンポーネントを使わないと AMP として認定されないので markdown パーサーライブラリを拡張して、markdown から <code>&lt;amp-img&gt;</code> にパースさせるようにしています。ちなみに、画像の最適化には <a href="https://github.com/oliver-moran/jimp">Jimp</a> という Node.js のライブラリを使っています。<br>また、ノリで amp-install-serviceworker というコンポーネントを使って PWA 化もしています。PWAMP ですね。AMP as PWA ですね。<br>他には一応 amp-social-share というコンポーネントでソーシャル・シェア・ボタンの設置をしています。今後は外部サービスの embed 表示のコンポーネントを使ってみようかなという気分でいます。</p>
<p><img src="https://lh3.googleusercontent.com/pw/AM-JKLVCcxjSmvPAtGMoQu5C2U6bkmhF7q2ir445qWm6eoQnIA8zh59um6KrMd_gIloSBBB7ArCF7C3tDIyJQm8VZkBXLMC7EYf73_YQfG-2cYwP378fHnxRZwD-BZr2fchDDkOlMNxm-apYJi64sIFyRJvRlQ" alt="有効な AMP ページですドヤ画像" width="780" height="461" loading="lazy" /></p>
<p><small><a href="https://search.google.com/test/amp?id=ZklJjOweBq3q7ShDW4a7XA">AMP テスト結果</a></small></p>
<p>そんなわけで、Web パフォーマンスにはそれなりには気を遣っているつもりでおりまして、<a href="https://developers.google.com/web/fundamentals/performance/prpl-pattern/?hl=ja">PRPL Pattern</a> というのにも一応目配せしていたりもします。Push、Render、Pre-cache、Lazy-load の頭文字を取ったというものですが、当ブログでの対応と合わせて見ていきます。</p>
<h4 id="push--render">Push / Render</h4>
<p>これは Critical Rendering Path (ページの初期描画みたいな) の最適化するぞということのようで、外部 CSS のインライン化 ( <code>&lt;style&gt;&lt;/style&gt;</code> ) や HTTP/2 の Push 配信や、必要リソース取得の最適化・優先度付けなどが代表的なものとして挙げられますね。<br>当ブログではスタイルのインライン化は <a href="https://www.ampproject.org/ja/docs/design/responsive_amp">AMP のルール</a>で、HTTP/2 対応は Firebase Hosting により、リソース取得最適化は Google Fonts (しかない) を <a href="https://www.w3.org/TR/resource-hints/">Resource Hints</a> で実現しています。</p>
<h4 id="pre-cache">Pre-cache</h4>
<p>Service Worker で記事リソースの先読みをしています。当ブログではハマりどころが多かったです。Workbox でハマり、Cloud Functions / Hosting での静的リソースのパス付けにハマり（これは Node.js か)。。</p>
<h4 id="lazy-load">Lazy-load</h4>
<p>画像だけ対応しています。しかも <code>&lt;amp-img&gt;</code> なので勝手に。markdown は対応していません。検討課題でしょうか。</p>
<h2 id="その他">その他</h2>
<p><a href="https://github.com/hrfmmymt/iiyatsu">hrfmmymt/iiyatsu</a><br>あとはコードフォーマットに prettier 使ったり、textlint で文書校正したりしてます。他なんかやったら随時。</p>
<ul>
<li><a href="/posts/20180808">TypeScriptはじめました - 20180808</a></li>
<li><a href="/posts/amp-list">amp-list でこのサイトの最新記事 n 件をリスト表示する - 20180811</a></li>
<li><a href="/posts/md-amp-img-webp">markdown から amp-img で webp 表示＆フォールバックのやつした - 20180814</a></li>
</ul>
<h2 id="おわりに">おわりに</h2>
<p>特にフロントエンド側はそんな書くことないだろうと思って書き進めてみたら疲れました。同時に、検討課題もまだまだあるのが見えてきました。<br>最後に Lighthouse のドヤスクショでお別れしましょう。さようなら。</p>
<p><img src="https://lh3.googleusercontent.com/pw/AM-JKLWlzlL3h7XaWec-arPSnN7mGlSYhWenQnAiGzYGItHnrsETcRENP_697JFZ5lKTfe5vtp5mXQ02d4b6tHItiruEA_-5PAh5PBJ1HAqt-lp0DuB04D03MZcZ-9sPHgKBjKRS4V-UMhAAHFLnEvdcG7g9xQ" alt="Lighthouse ドヤ画像" width="780" height="130" loading="lazy" /></p>
<footer class="post-footer">&#8718;</footer><nav class="post-recent"><dl><dt>次に出た記事</dt><dd><a href="20180808">TypeScript はじめました</a></dd><dt>前に出た記事</dt><dd><a href="20180727">おーい御社</a></dd></dl></nav>
    </body>
  </html>
  